!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t,e){function n(t){function e(t){i?(n(),F(e),o=!0,i=!1):o=!1}var n=t,i=!1,o=!1;this.kick=function(t){i=!0,o||e()},this.end=function(t){var e=n;t&&(o?(n=i?function(){e(),t()}:t,i=!0):t())}}function i(){return!0}function o(){return!1}function r(t){t.preventDefault()}function a(t){M[t.target.tagName.toLowerCase()]||t.preventDefault()}function u(t){return 1===t.which&&!t.ctrlKey&&!t.altKey}function c(t,e){var n,i;if(t.identifiedTouch)return t.identifiedTouch(e);for(n=-1,i=t.length;++n<i;)if(t[n].identifier===e)return t[n]}function s(t,e){var n=c(t.changedTouches,e.identifier);if(n&&(n.pageX!==e.pageX||n.pageY!==e.pageY))return n}function d(t){var e;u(t)&&(e={target:t.target,startX:t.pageX,startY:t.pageY,timeStamp:t.timeStamp},L(document,j.move,h,e),L(document,j.cancel,l,e))}function h(t){var e=t.data;y(t,e,t,f)}function l(t){f()}function f(){z(document,j.move,h),z(document,j.cancel,l)}function p(t){var e,n;M[t.target.tagName.toLowerCase()]||(e=t.changedTouches[0],n={target:e.target,startX:e.pageX,startY:e.pageY,timeStamp:t.timeStamp,identifier:e.identifier},L(document,O.move+"."+e.identifier,v,n),L(document,O.cancel+"."+e.identifier,m,n))}function v(t){var e=t.data,n=s(t,e);n&&y(t,e,n,g)}function m(t){var e=t.data,n=c(t.changedTouches,e.identifier);n&&g(e.identifier)}function g(t){z(document,"."+t,v),z(document,"."+t,m)}function y(t,e,n,i){var o=n.pageX-e.startX,r=n.pageY-e.startY;P*P>o*o+r*r||Y(t,e,n,o,r,i)}function w(){return this._handled=i,!1}function _(t){t._handled()}function Y(t,e,n,i,o,r){var a,u;e.target;a=t.targetTouches,u=t.timeStamp-e.timeStamp,e.type="movestart",e.distX=i,e.distY=o,e.deltaX=i,e.deltaY=o,e.pageX=n.pageX,e.pageY=n.pageY,e.velocityX=i/u,e.velocityY=o/u,e.targetTouches=a,e.finger=a?a.length:1,e._handled=w,e._preventTouchmoveDefault=function(){t.preventDefault()},D(e.target,e),r(e.identifier)}function X(t){var e=t.data.timer;t.data.touch=t,t.data.timeStamp=t.timeStamp,e.kick()}function T(t){var e=t.data.event,n=t.data.timer;k(),S(e,n,function(){setTimeout(function(){z(e.target,"click",o)},0)})}function k(t){z(document,j.move,X),z(document,j.end,T)}function A(t){var e=t.data.event,n=t.data.timer,i=s(t,e);i&&(t.preventDefault(),e.targetTouches=t.targetTouches,t.data.touch=i,t.data.timeStamp=t.timeStamp,n.kick())}function b(t){var e=t.data.event,n=t.data.timer,i=c(t.changedTouches,e.identifier);i&&(I(e),S(e,n))}function I(t){z(document,"."+t.identifier,A),z(document,"."+t.identifier,b)}function C(t,e,n,i){var o=n-t.timeStamp;t.type="move",t.distX=e.pageX-t.startX,t.distY=e.pageY-t.startY,t.deltaX=e.pageX-t.pageX,t.deltaY=e.pageY-t.pageY,t.velocityX=.3*t.velocityX+.7*t.deltaX/o,t.velocityY=.3*t.velocityY+.7*t.deltaY/o,t.pageX=e.pageX,t.pageY=e.pageY}function S(t,e,n){e.end(function(){return t.type="moveend",D(t.target,t),n&&n()})}function x(t,e,n){return L(this,"movestart.move",_),!0}function E(t){return z(this,"dragstart drag",r),z(this,"mousedown touchstart",a),z(this,"movestart",_),!0}function R(t){"move"!==t.namespace&&"moveend"!==t.namespace&&(L(this,"dragstart."+t.guid+" drag."+t.guid,r,e,t.selector),L(this,"mousedown."+t.guid,a,e,t.selector))}function $(t){"move"!==t.namespace&&"moveend"!==t.namespace&&(z(this,"dragstart."+t.guid+" drag."+t.guid),z(this,"mousedown."+t.guid))}var P=6,L=t.event.add,z=t.event.remove,D=function(e,n,i){t.event.trigger(n,i,e)},F=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){return window.setTimeout(function(){t()},25)}}(),M={textarea:!0,input:!0,select:!0,button:!0},j={move:"mousemove",cancel:"mouseup dragstart",end:"mouseup"},O={move:"touchmove",cancel:"touchend",end:"touchend"};t.event.special.movestart={setup:x,teardown:E,add:R,remove:$,_default:function(t){function i(e){C(r,a.touch,a.timeStamp),D(t.target,r)}var r,a;t._handled()&&(r={target:t.target,startX:t.startX,startY:t.startY,pageX:t.pageX,pageY:t.pageY,distX:t.distX,distY:t.distY,deltaX:t.deltaX,deltaY:t.deltaY,velocityX:t.velocityX,velocityY:t.velocityY,timeStamp:t.timeStamp,identifier:t.identifier,targetTouches:t.targetTouches,finger:t.finger},a={event:r,timer:new n(i),touch:e,timeStamp:e},t.identifier===e?(L(t.target,"click",o),L(document,j.move,X,a),L(document,j.end,T,a)):(t._preventTouchmoveDefault(),L(document,O.move+"."+t.identifier,A,a),L(document,O.end+"."+t.identifier,b,a)))}},t.event.special.move={setup:function(){L(this,"movestart.move",t.noop)},teardown:function(){z(this,"movestart.move",t.noop)}},t.event.special.moveend={setup:function(){L(this,"movestart.moveend",t.noop)},teardown:function(){z(this,"movestart.moveend",t.noop)}},L(document,"mousedown.move",d),L(document,"touchstart.move",p),"function"==typeof Array.prototype.indexOf&&!function(t,e){for(var n=["changedTouches","targetTouches"],i=n.length;i--;)-1===t.event.props.indexOf(n[i])&&t.event.props.push(n[i])}(t)}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t,e){function n(t){var e,n,i;e=t.currentTarget.offsetWidth,n=t.currentTarget.offsetHeight,i={distX:t.distX,distY:t.distY,velocityX:t.velocityX,velocityY:t.velocityY,finger:t.finger},t.distX>t.distY?t.distX>-t.distY?(t.distX/e>u.threshold||t.velocityX*t.distX/e*u.sensitivity>1)&&(i.type="swiperight",a(t.currentTarget,i)):(-t.distY/n>u.threshold||t.velocityY*t.distY/e*u.sensitivity>1)&&(i.type="swipeup",a(t.currentTarget,i)):t.distX>-t.distY?(t.distY/n>u.threshold||t.velocityY*t.distY/e*u.sensitivity>1)&&(i.type="swipedown",a(t.currentTarget,i)):(-t.distX/e>u.threshold||t.velocityX*t.distX/e*u.sensitivity>1)&&(i.type="swipeleft",a(t.currentTarget,i))}function i(e){var n=t.data(e,"event_swipe");return n||(n={count:0},t.data(e,"event_swipe",n)),n}var o=t.event.add,r=t.event.remove,a=function(e,n,i){t.event.trigger(n,i,e)},u={threshold:.4,sensitivity:6};t.event.special.swipe=t.event.special.swipeleft=t.event.special.swiperight=t.event.special.swipeup=t.event.special.swipedown={setup:function(t,e,r){var t=i(this);if(!(t.count++>0))return o(this,"moveend",n),!0},teardown:function(){var t=i(this);if(!(--t.count>0))return r(this,"moveend",n),!0},settings:u}}),function(t){function e(t,e){for(var n=t.length;n--;)if(t[n]===e)return n;return-1}function n(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function i(t){for(w in Y)Y[w]=t[I[w]]}function o(t){var n,o,r,a,c,s;if(n=t.keyCode,-1==e(b,n)&&b.push(n),(93==n||224==n)&&(n=91),n in Y){Y[n]=!0;for(r in T)T[r]==n&&(u[r]=!0)}else if(i(t),u.filter.call(this,t)&&n in _)for(s=f(),a=0;a<_[n].length;a++)if(o=_[n][a],o.scope==s||"all"==o.scope){c=o.mods.length>0;for(r in Y)(!Y[r]&&e(o.mods,+r)>-1||Y[r]&&-1==e(o.mods,+r))&&(c=!1);(0!=o.mods.length||Y[16]||Y[18]||Y[17]||Y[91])&&!c||o.method(t,o)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0))}}function r(t){var n,i=t.keyCode,o=e(b,i);if(o>=0&&b.splice(o,1),(93==i||224==i)&&(i=91),i in Y){Y[i]=!1;for(n in T)T[n]==i&&(u[n]=!1)}}function a(){for(w in Y)Y[w]=!1;for(w in T)u[w]=!1}function u(t,e,n){var i,o;i=v(t),void 0===n&&(n=e,e="all");for(var r=0;r<i.length;r++)o=[],t=i[r].split("+"),t.length>1&&(o=m(t),t=[t[t.length-1]]),t=t[0],t=A(t),t in _||(_[t]=[]),_[t].push({shortcut:i[r],scope:e,method:n,key:i[r],mods:o})}function c(t,e){var i,o,r,a,u,c=[];for(i=v(t),a=0;a<i.length;a++){if(o=i[a].split("+"),o.length>1&&(c=m(o)),t=o[o.length-1],t=A(t),void 0===e&&(e=f()),!_[t])return;for(r=0;r<_[t].length;r++)u=_[t][r],u.scope===e&&n(u.mods,c)&&(_[t][r]={})}}function s(t){return"string"==typeof t&&(t=A(t)),-1!=e(b,t)}function d(){return b.slice(0)}function h(t){var e=(t.target||t.srcElement).tagName;return!("INPUT"==e||"SELECT"==e||"TEXTAREA"==e)}function l(t){X=t||"all"}function f(){return X||"all"}function p(t){var e,n,i;for(e in _)for(n=_[e],i=0;i<n.length;)n[i].scope===t?n.splice(i,1):i++}function v(t){var e;return t=t.replace(/\s/g,""),e=t.split(","),""==e[e.length-1]&&(e[e.length-2]+=","),e}function m(t){for(var e=t.slice(0,t.length-1),n=0;n<e.length;n++)e[n]=T[e[n]];return e}function g(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,function(){n(window.event)})}function y(){var e=t.key;return t.key=C,e}var w,_={},Y={16:!1,18:!1,17:!1,91:!1},X="all",T={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},k={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},A=function(t){return k[t]||t.toUpperCase().charCodeAt(0)},b=[];for(w=1;20>w;w++)k["f"+w]=111+w;var I={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(w in T)u[w]=!1;g(document,"keydown",function(t){o(t)}),g(document,"keyup",r),g(window,"focus",a);var C=t.key;t.key=u,t.key.setScope=l,t.key.getScope=f,t.key.deleteScope=p,t.key.filter=h,t.key.isPressed=s,t.key.getPressedKeyCodes=d,t.key.noConflict=y,t.key.unbind=c,"undefined"!=typeof module&&(module.exports=u)}(this);var ArrayProto,nativeForEach,nativeIsArray,nativeMap,nativeReduce,__hasProp={}.hasOwnProperty;("undefined"==typeof _||null===_)&&(this._={},ArrayProto=Array.prototype,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeIsArray=Array.isArray,_.isObject=function(t){var e;return e=typeof t,"function"===e||"object"===e&&!!t},_.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},_.each=function(t,e,n){var i,o,r,a,u,c;try{if(nativeForEach&&t.forEach===nativeForEach)t.forEach(e,n);else if(_.isNumber(t.length))for(o=u=0,c=t.length;c>=0?c>u:u>c;o=c>=0?++u:--u)e.call(n,t[o],o,t);else for(r in t)__hasProp.call(t,r)&&(a=t[r],e.call(n,a,r,t))}catch(s){i=s}return t},_.map=function(t,e,n){var i;return nativeMap&&t.map===nativeMap?t.map(e,n):(i=[],_.each(t,function(t,o,r){return i.push(e.call(n,t,o,r))}),i)},_.reduce=function(t,e,n,i){return nativeReduce&&t.reduce===nativeReduce?(i&&(e=_.bind(e,i)),t.reduce(e,n)):(_.each(t,function(t,o,r){return n=e.call(i,n,t,o,r)}),n)},_.isArray=nativeIsArray||function(t){return!(!(t&&t.concat&&t.unshift)||t.callee)},_.max=function(t,e,n){var i;return!e&&_.isArray(t)?Math.max.apply(Math,t):(i={computed:-(1/0)},_.each(t,function(t,o,r){var a;return a=e?e.call(n,t,o,r):t,a>=i.computed&&(i={value:t,computed:a})}),i.value)},_.min=function(t,e,n){var i;return!e&&_.isArray(t)?Math.min.apply(Math,t):(i={computed:1/0},_.each(t,function(t,o,r){var a;return a=e?e.call(n,t,o,r):t,a<i.computed&&(i={value:t,computed:a})}),i.value)},_.now=Date.now||function(){return(new Date).getTime()},_.throttle=function(t,e,n){var i,o,r,a,u,c;return o=void 0,i=void 0,u=void 0,c=null,a=0,n||(n={}),r=function(){a=n.leading===!1?0:_.now(),c=null,u=t.apply(o,i),o=i=null},function(){var s,d;return s=_.now(),a||n.leading!==!1||(a=s),d=e-(s-a),o=this,i=arguments,0>=d?(clearTimeout(c),c=null,a=s,u=t.apply(o,i),o=i=null):c||n.trailing===!1||(c=setTimeout(r,d)),u}},_.debounce=function(t,e,n){var i,o,r,a,u,c;return u=void 0,i=void 0,o=void 0,c=void 0,a=void 0,r=function(){var s;s=_.now()-c,e>s?u=setTimeout(r,e-s):(u=null,n||(a=t.apply(o,i),o=i=null))},function(){var s;return o=this,i=arguments,c=_.now(),s=n&&!u,u||(u=setTimeout(r,e)),s&&(a=t.apply(o,i),o=i=null),a}}),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}};this.Chromatic=this.Chromatic||{},t=function(){var t;return t={},function(e,n){var i,o,r,a,u,c,s,d,h,l,f,p,v,m,g,y,w,Y;if(a=e.join()+n,t[a])return t[a];if(s=e.length,0>=n)return[];if(n>s)return e.map(function(t){return[t]});for(y=function(){var t,e,i;for(i=[],Y=t=0,e=s;e>=0?e>t:t>e;Y=e>=0?++t:--t)i.push(function(){var t,e,i;for(i=[],w=t=0,e=n;e>=0?e>t:t>e;w=e>=0?++t:--t)i.push(0);return i}());return i}(),g=function(){var t,e,i;for(i=[],Y=t=0,e=s-1;e>=0?e>t:t>e;Y=e>=0?++t:--t)i.push(function(){var t,e,i;for(i=[],w=t=0,e=n-1;e>=0?e>t:t>e;w=e>=0?++t:--t)i.push(0);return i}());return i}(),o=u=0,l=s;l>=0?l>u:u>l;o=l>=0?++u:--u)y[o][0]=e[o]+(o?y[o-1][0]:0);for(r=d=0,f=n;f>=0?f>d:d>f;r=f>=0?++d:--d)y[0][r]=e[0];for(o=h=1,p=s;p>=1?p>h:h>p;o=p>=1?++h:--h)for(r=m=1,v=n;v>=1?v>m:m>v;r=v>=1?++m:--m)c=_.min(function(){var t,e,n;for(e=[],w=n=0,t=o;t>=0?t>n:n>t;w=t>=0?++n:--n)e.push([_.max([y[w][r-1],y[o][0]-y[w][0]]),w]);return e}(),function(t){return t[0]}),y[o][r]=c[0],g[o-1][r-1]=c[1];for(s-=1,n-=2,i=[];n>=0&&s>0;)i=[function(){var t,i,r,a;for(r=[],o=a=t=g[s-1][n]+1,i=s+1;i>=t?i>a:a>i;o=i>=t?++a:--a)r.push(e[o]);return r}()].concat(i),s=g[s-1][n],n-=1;return t[a]=[function(){var t,n,i;for(n=[],o=i=0,t=s+1;t>=0?t>i:i>t;o=t>=0?++i:--i)n.push(e[o]);return n}()].concat(i)}}(),e=function(){var t;return t=null,function(){var e,n,i;return t?t:(e=$('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div></div>'),$(document.body).append(e),n=$("div",e).innerWidth(),e.css("overflow-y","auto"),i=$("div",e).innerWidth(),$(e).remove(),t=n-i)}}(),Chromatic.GalleryView=function(){function i(t,e,i){this.layout=n(this.layout,this),this.lazyLoad=n(this.lazyLoad,this),this.calculateAspectRatios=n(this.calculateAspectRatios,this),t[0]===document.body?(this.el=$('<div class="chromatic-gallery-full"/>'),$(t).append(this.el)):this.el=$(t).addClass("chromatic-gallery"),this.photos=_.map(e,function(t){return _.isObject(t)?t:{small:t}}),this.photo_views=_.map(this.photos,function(t){return function(e){return new Chromatic.GalleryPhotoView(t,e,i)}}(this)),this.ideal_height=parseInt(this.el.children().first().css("height")),this.viewport=$((i||{}).viewport||this.el),$(window).on("resize",_.debounce(this.layout,100)),this.viewport.on("scroll",_.throttle(this.lazyLoad,100)),this.photos[0]||this.photos[0].aspect_ratio?this.layout():this.calculateAspectRatios()}return i.prototype.calculateAspectRatios=function(){var t;return t=_.after(this.photos.length,this.layout),_.each(this.photo_views,function(e){return e.load(t)})},i.prototype.lazyLoad=function(){var t,e,n;return t=1e3,n=this.viewport.scrollTop()-t,e=(this.viewport.height()||$(window).height())+this.viewport.scrollTop()+t,_.each(this.photo_views,function(t){return function(t){return t.top<e&&t.bottom>n?t.load():t.unload()}}(this))},i.prototype.layout=function(){var n,i,o,r,a,u,c;return $(document.body).css("overflowY","scroll"),u=this.el[0].getBoundingClientRect().width-parseInt(this.el.css("paddingLeft"))-parseInt(this.el.css("paddingRight")),this.el[0].offsetWidth>this.el[0].scrollWidth&&(u-=e()),$(document.body).css("overflowY","auto"),n=this.ideal_height||parseInt((this.el.height()||$(window).height())/2),a=_.reduce(this.photos,function(t,e){return t+=e.aspect_ratio*n},0),r=Math.round(a/u),1>r?_.each(this.photos,function(t){return function(e,i){return t.photo_views[i].resize(parseInt(n*e.aspect_ratio),n)}}(this)):(c=_.map(this.photos,function(t){return parseInt(100*t.aspect_ratio)}),o=t(c,r),i=0,_.each(o,function(t){return function(e){var n,o;return n=[],_.each(e,function(e,o){return n.push(t.photos[i+o])}),o=_.reduce(n,function(t,e){return t+=e.aspect_ratio},0),a=0,_.each(n,function(e,r){var c,s;return s=r===n.length-1?u-a:parseInt(u/o*e.aspect_ratio),c=parseInt(u/o),t.photo_views[i+r].resize(s,c),a+=s}),i+=e.length}}(this))),this.lazyLoad()},i}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.Chromatic=this.Chromatic||{},Chromatic.GalleryPhotoView=function(){function e(e,n,i){this.unload=t(this.unload,this),this.load=t(this.load,this);var o,r,a;this.parent=e,this.photo=n,this.el=$('<div class="chromatic-gallery-photo"/>'),r=this.photo;for(o in r)a=r[o],(0===o.lastIndexOf("data",0)||0===o.lastIndexOf("mfp",0)||0===o.lastIndexOf("id",0))&&this.el.attr(o,a);e.el.append(this.el)}return e.prototype.load=function(t){var e;if(!this.loaded)return e=new Image,e.onload=function(n){return function(){return n.photo.aspect_ratio=e.width/e.height,t&&t(),n.el.css("backgroundImage","url("+n.photo.small+")"),n.loaded=!0}}(this),e.src=this.photo.small},e.prototype.unload=function(){return this.el.css("backgroundImage",""),this.loaded=!1},e.prototype.resize=function(t,e){return this.el.css({width:t-parseInt(this.el.css("marginLeft"))-parseInt(this.el.css("marginRight")),height:e-parseInt(this.el.css("marginTop"))-parseInt(this.el.css("marginBottom"))}),this.top=this.el.offset().top,this.bottom=this.top+this.el.height()},e}()}.call(this),function(){$.fn.extend({chromatic:function(t,e){return new Chromatic.GalleryView(this,t,e),this}})}.call(this);